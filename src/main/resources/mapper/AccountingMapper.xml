<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shsoftvina.erpshsoftvina.mapper.AccountingMapper">
    <select id="findAllMonthlyHistory" resultType="string">
        SELECT DISTINCT DATE_FORMAT(created_date, '%Y - %m') AS month
        FROM accounting
    </select>

    <select id="getTotalRecordCountPerMonth" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM accounting
        WHERE MONTH(created_date) = #{monthId}
    </select>

    <select id="findAccountingByMonth" parameterType="org.apache.ibatis.session.RowBounds" resultMap="accountingResultMap" >
        SELECT a.*, u.username
        FROM accounting a
        INNER JOIN
            user u
        ON a.user_id = u.id
        WHERE MONTH(created_date) = #{monthId};
    </select>

    <resultMap id="accountingResultMap" type="com.shsoftvina.erpshsoftvina.entity.Accounting">
        <id property="id" column="id"/>
        <result property="createdDate" column="created_date"/>
        <result property="expense" column="spending"/>
        <result property="remain" column="remain"/>
        <result property="bill" column="bill"/>
        <result property="title" column="title"/>
        <association property="user" column="user_id" javaType="com.shsoftvina.erpshsoftvina.entity.User" resultMap="userResultMap">
        </association>
    </resultMap>

    <resultMap id="userResultMap" type="com.shsoftvina.erpshsoftvina.entity.User">
        <id property="id" column="id" />
        <result property="username" column="username" />
    </resultMap>
</mapper>